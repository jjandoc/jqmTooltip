(function(a){a.fn.jqmTooltip=function(b){function f(b){if(b="all"){b=a(".jqmTooltip")}a(b).removeClass("active").fadeOut(c.fadeSpeed)}function e(b){a(b).addClass("active").fadeIn(c.fadeSpeed)}var c={arrow:true,fadeSpeed:200,maxWidth:280,minSideMargins:15,position:"autoUnder",offset:15,text:"title"},d;if(c.text=="title"){d=true}this.parents('div:jqmData(role="page")').bind("tap.jqmTooltip",function(a){f("all")});a(window).bind("resize.jqmTooltip",function(a){f("all")});return this.each(function(){if(b){a.extend(c,b)}var g=a(this),h={},i="tooltip-"+Math.floor(Math.random()*1e3),j,k,l,m,n,o,p,q;j=a('<div class="jqmTooltip">');if(d){c.text=g.attr("title");g.attr("title","")}j.html(c.text).attr("id",i).css("display","none").append('<a href="#" class="close">&#215;</div>').find(".close").bind("tap",function(a){a.preventDefault();f("#"+i)});if(c.arrow){j.append('<div class="arrow">');var r}g.parents('div:jqmData(role="page")').append(j);g.bind("tap.jqmTooltip",function(b){b.stopPropagation();if(j.hasClass("active")){f(j)}else{n=a(b.target);o=n.offset();p=a(window).height();q=a(window).width();k=q-2*c.minSideMargins;if(k>c.maxWidth){k=c.maxWidth}h.width=k;l=o.left+n.width()/2-k/2;if(l+k>q){h.left="auto";h.right=c.minSideMargins;if(c.arrow){m=j.offset();r=o.left-(q-c.minSideMargins-k)+n.width()/2+"px";j.find(".arrow").css("left",r)}}else if(l<0){h.left=c.minSideMargins;h.right="auto";if(c.arrow){r=o.left-c.minSideMargins+n.width()/2+"px";j.find(".arrow").css("left",r)}}else{h.left=o.left+n.width()/2-k/2;if(c.arrow){j.find(".arrow").css("left","50%")}}switch(c.position){case"over":j.css(h);e(j);h.top=o.top-j.outerHeight()-c.offset+"px";j.addClass("over").removeClass("under").css(h);break;case"under":h.top=o.top+n.outerHeight()+c.offset+"px";h.bottom="auto";j.addClass("under").css(h);e(j);break;case"autoOver":j.css(h);e(j);if(j.outerHeight()+c.offset>o.top-a(window).scrollTop()){h.top=o.top+n.outerHeight()+c.offset+"px";j.addClass("under").removeClass("over").css(h)}else{h.top=o.top-j.outerHeight()-c.offset+"px";j.addClass("over").removeClass("under").css(h)}break;default:j.css(h);e(j);if(j.outerHeight()+c.offset>a(window).height()-o.top){h.top=o.top-j.outerHeight()-c.offset+"px";j.addClass("over").removeClass("under").css(h)}else{h.top=o.top+n.outerHeight()+c.offset+"px";j.addClass("under").removeClass("over").css(h)}break}}})})}})(jQuery)